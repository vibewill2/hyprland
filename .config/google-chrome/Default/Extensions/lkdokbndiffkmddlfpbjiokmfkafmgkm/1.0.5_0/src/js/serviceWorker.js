const m=()=>new Promise((e=>{chrome.tabs.query({active:!0},(function([{url:t}]){t&&(t.includes("chrome://")||t.includes("chrome-extension:")||t.includes("https://chrome.google.com")||t.includes("https://chromewebstore.google.com"))?e(!1):e(!!t)}))})),s=(e,t)=>{const n=e.selectionText||"",o=e.linkUrl||"",a=e.srcUrl||"";let c=e.pageUrl||"";o.length>0?c=o:n.length>0?c=n:a.length>0&&(c=a),chrome.tabs.query({active:!0},(async function(e){const n=e.length>0?e[0]:t,o=n?n.id:null;o&&await m()&&chrome.tabs.sendMessage(o,{action:"startLightbox",greeting:c,pageTitle:n.title})}))},a=async e=>{await m()?chrome.contextMenus.update("generateQRCode",{visible:!0}):(await chrome.action.enable(e.id),await chrome.action.setPopup({tabId:e.id,popup:"src/layouts/popup.html"}),chrome.contextMenus.update("generateQRCode",{visible:!1}))};chrome.contextMenus.create({id:"generateQRCode",title:"Generate QR Code",contexts:["link","selection","page","image"]}),chrome.action.onClicked.addListener((function(e){s({pageUrl:e.url,selectionText:e.url},e)})),chrome.runtime.onMessage.addListener((function(e){"open_new_tab"===e.message&&chrome.tabs.create({url:e.url})})),chrome.contextMenus.onClicked.addListener(((e,t)=>{"generateQRCode"===e.menuItemId&&s(e,t)})),chrome.commands.onCommand.addListener(((e,t)=>{"makeQRCode"===e&&s({pageUrl:t.url,selectionText:t.url},t)})),chrome.tabs.onUpdated.addListener((function(e,t,n){a(n)})),chrome.tabs.onCreated.addListener((function(e){a(e)})),chrome.tabs.onActivated.addListener((e=>{chrome.tabs.get(e.tabId).then((e=>{a(e)}))}));